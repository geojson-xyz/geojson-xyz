#!/usr/bin/env node

var inquirer = require('inquirer'),
  fs = require('fs'),
  chalk = require('chalk'),
  toClipboard = require('to-clipboard'),
  choices = require('./lib/choices'),
  fuzzy = require('./lib/fuzzy'),
  getGeojson = require('./'),
  argv = require('yargs')
    .usage('Get GeoJSON\n$0')
    .boolean('all')
    .describe('all', 'show files that are bigger than 2MB')
    .help('help')
    .argv;

var base = 'https://s3.amazonaws.com/geojson-please/';
var naturalEarthSlug = 'naturalearth-3.3.0';
var license = 'SOURCE: http://www.naturalearthdata.com/ Public Domain (no restrictions)';

var options = {
  all: argv.all
};

if (argv._[0]) {
  getGeojson(argv._[0], function (err, result) {
    if (err) throw new Error(err);

    if (argv._[1] === '--') {
      console.log(JSON.stringify(result.geojson))
    } else {
      console.log(chalk.green('✓ ') + chalk.bold('saved as ' + result.file));
      console.log(license);
      fs.writeFileSync(result.file, JSON.stringify(result.geojson));
    }
  });
  return;
}

inquirer.prompt(choices(options), function(answers) {
  var url = base + naturalEarthSlug + '/' + answers.file;
  if (answers.output === 'URL to Clipboard') {
    toClipboard(url);
    console.log('');
    console.log(chalk.green('✓ ') + chalk.bold('copied url to clipboard'));
    console.log(url);
    console.log(license);
  } else {
    getGeojson(answers.file, function(err, result) {
      fs.writeFileSync(result.file, JSON.stringify(result.geojson));
      console.log('');
      console.log(chalk.green('✓ ') + chalk.bold('saved as ' + result.file));
      console.log(license);
    });
  }
});
